<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SpillTea â˜•</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<style>
body{margin:0;background:#0f0f0f;color:#fff;font-family:system-ui}
header,nav{background:#161616;padding:12px;display:flex;justify-content:space-between;align-items:center}
button{background:#ffb703;border:none;padding:8px 14px;border-radius:20px}
.page{display:none;padding:12px}
.page.active{display:block}
.card{background:#1e1e1e;padding:12px;border-radius:14px;margin:10px 0}
textarea,input{width:100%;padding:10px;border-radius:10px;border:none}
small{color:#aaa}
</style>
</head>

<body>

<header>
<b>â˜• SpillTea</b>
<button id="authBtn">Login</button>
</header>

<!-- HOME -->
<div id="home" class="page active">
<textarea id="teaText" placeholder="Spill tea..."></textarea>
<button onclick="postTea()">Spill</button>
<div id="feed"></div>
</div>

<!-- FOLLOWERS TEA -->
<div id="followers" class="page">
<h3>Followers Tea</h3>
<div id="followersFeed"></div>
</div>

<!-- BROWSE -->
<div id="browse" class="page">
<input id="searchUid" placeholder="Search UID">
<button onclick="followUser()">Follow</button>
</div>

<!-- GCS -->
<div id="gcs" class="page">
<h3>Group Chats</h3>
<small>Coming soon</small>
</div>

<!-- PROFILE -->
<div id="profile" class="page">
<h3>Profile</h3>
<textarea id="bio" placeholder="Your bio"></textarea>
<button onclick="saveBio()">Save Bio</button>
<p id="stats"></p>
<div id="myPosts"></div>
</div>

<nav>
<button onclick="go('home')">ğŸ </button>
<button onclick="go('followers')">ğŸ‘¥</button>
<button onclick="go('browse')">ğŸ”</button>
<button onclick="go('gcs')">ğŸ’¬</button>
<button onclick="go('profile')">ğŸ‘¤</button>
</nav>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBsCftGcy-dH8RxxP2UxKoGG4DapRHHASo",
 authDomain:"spilltea-54aa8.firebaseapp.com",
 projectId:"spilltea-54aa8"
});

const auth=firebase.auth();
const db=firebase.firestore();
let me=null;

// AUTH
auth.onAuthStateChanged(u=>{
 me=u;
 authBtn.innerText=u?"Logout":"Login";
 if(u){
  loadFeed();
  loadProfile();
  loadFollowersFeed();
 }
});

authBtn.onclick=()=>{
 me?auth.signOut():auth.signInWithRedirect(new firebase.auth.GoogleAuthProvider());
};

// NAV
function go(p){
 document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
 document.getElementById(p).classList.add('active');
}

// POST TEA
function postTea(){
 if(!me) return alert("Login first");
 const text=teaText.value.trim();
 if(!text) return;
 db.collection("teas").add({
  text,
  uid:me.uid,
  time:Date.now()
 });
 teaText.value="";
}

// LOAD FEED
function loadFeed(){
 db.collection("teas").orderBy("time","desc")
 .onSnapshot(s=>{
  feed.innerHTML="";
  s.forEach(d=>{
   feed.innerHTML+=teaCard(d.id,d.data());
  });
 });
}

// COMMENTS
function addComment(id){
 const c=prompt("Comment");
 if(!c) return;
 db.collection("teas").doc(id)
 .collection("comments").add({
  text:c,
  time:Date.now()
 });
}

// CARD
function teaCard(id,p){
 return `
 <div class="card">
  <p>${p.text}</p>
  <small>${new Date(p.time).toLocaleString()}</small><br>
  <button onclick="addComment('${id}')">ğŸ’¬ Comment</button>
 </div>`;
}

// FOLLOW
function followUser(){
 const uid=searchUid.value.trim();
 if(!uid||!me) return;
 db.collection("follows").doc(me.uid+"_"+uid)
 .set({from:me.uid,to:uid});
 alert("Followed");
}

// FOLLOWERS FEED
function loadFollowersFeed(){
 db.collection("follows").where("from","==",me.uid)
 .onSnapshot(s=>{
  followersFeed.innerHTML="";
  s.forEach(f=>{
   db.collection("teas").where("uid","==",f.data().to)
   .onSnapshot(t=>{
    t.forEach(d=>{
     followersFeed.innerHTML+=teaCard(d.id,d.data());
    });
   });
  });
 });
}

// PROFILE
function saveBio(){
 db.collection("users").doc(me.uid)
 .set({bio:bio.value},{merge:true});
}

function loadProfile(){
 db.collection("users").doc(me.uid).get().then(d=>{
  if(d.exists) bio.value=d.data().bio||"";
 });
 db.collection("teas").where("uid","==",me.uid)
 .onSnapshot(s=>{
  stats.innerText=`Posts: ${s.size}`;
  myPosts.innerHTML="";
  s.forEach(d=>{
   myPosts.innerHTML+=teaCard(d.id,d.data());
  });
 });
}
</script>

</body>
</html>
