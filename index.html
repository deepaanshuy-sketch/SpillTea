<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SpillTea â˜•</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
 --bg:#121212;
 --card:#1e1e1e;
 --accent:#8b5e34;
 --muted:#aaa;
}
body{
 margin:0;
 background:var(--bg);
 color:#fff;
 font-family:system-ui;
}
header{
 padding:1rem;
 background:#1a1a1a;
 display:flex;
 justify-content:space-between;
 align-items:center;
 position:sticky;
 top:0;
 z-index:10;
}
button{
 background:var(--accent);
 border:none;
 color:#fff;
 padding:8px 14px;
 border-radius:8px;
 cursor:pointer;
}
.page{
 display:none;
 padding:1rem;
 padding-bottom:6rem;
}
.page.active{display:block}
.card{
 background:var(--card);
 padding:1rem;
 border-radius:12px;
 margin-bottom:1rem;
}
textarea{
 width:100%;
 height:80px;
 border-radius:8px;
 border:none;
 padding:.5rem;
}
nav{
 position:fixed;
 bottom:0;
 width:100%;
 background:#1a1a1a;
 display:flex;
 justify-content:space-around;
 padding:.7rem 0;
}
nav span{
 cursor:pointer;
 font-size:1.3rem;
}
small{color:var(--muted)}
</style>
</head>

<body>

<header>
 <h3>SpillTea â˜•</h3>
 <button id="authBtn">Login</button>
</header>

<!-- HOME -->
<div id="home" class="page active">
 <div id="spillBox" style="display:none">
  <textarea id="teaText" placeholder="Spill tea â˜•"></textarea><br><br>
  <select id="anon">
   <option value="no">Public</option>
   <option value="yes">Anonymous</option>
  </select><br><br>
  <button id="spillBtn">Spill â˜•</button>
  <hr>
 </div>
 <div id="feed"></div>
</div>

<!-- FOLLOWERS TEA -->
<div id="followers" class="page">
 <h3>â¤ï¸ Followers Tea</h3>
 <div id="likedFeed"></div>
</div>

<!-- BROWSE -->
<div id="browse" class="page">
 <h3>ğŸ” Browse</h3>
 <div id="usersList"></div>
</div>

<!-- GCs -->
<div id="gcs" class="page">
 <h3>ğŸ’¬ Group Chats</h3>
 <div class="card">GC system coming next ğŸ”¥</div>
</div>

<!-- PROFILE -->
<div id="profile" class="page">
 <h3>ğŸ‘¤ Profile</h3>
 <div class="card" id="profileCard"></div>
 <button onclick="auth.signOut()">Logout</button>
</div>

<nav>
 <span onclick="showPage('home')">ğŸ </span>
 <span onclick="showPage('followers')">â¤ï¸</span>
 <span onclick="showPage('browse')">ğŸ”</span>
 <span onclick="showPage('gcs')">ğŸ’¬</span>
 <span onclick="showPage('profile')">ğŸ‘¤</span>
</nav>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey: "AIzaSyBsCftGcy-dH8RxxP2UxKoGG4DapRHHASo",
 authDomain: "spilltea-54aa8.firebaseapp.com",
 projectId: "spilltea-54aa8"
});

const auth = firebase.auth();
const db = firebase.firestore();
const provider = new firebase.auth.GoogleAuthProvider();

/* Navigation */
function showPage(id){
 document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

/* Auth */
const authBtn = document.getElementById("authBtn");
const spillBox = document.getElementById("spillBox");

auth.onAuthStateChanged(user=>{
 if(user){
  authBtn.innerText="Logout";
  spillBox.style.display="block";
  saveUser(user);
  loadFeed();
  loadUsers();
  loadProfile(user);
 }else{
  authBtn.innerText="Login";
  spillBox.style.display="none";
 }
});

authBtn.onclick=()=>{
 auth.currentUser ? auth.signOut() : auth.signInWithPopup(provider);
};

/* Save user */
function saveUser(u){
 db.collection("users").doc(u.uid).set({
  name:u.displayName,
  email:u.email
 },{merge:true});
}

/* Spill */
spillBtn.onclick=()=>{
 if(!auth.currentUser) return;
 const text=teaText.value.trim();
 if(!text) return;
 db.collection("posts").add({
  text,
  uid:auth.currentUser.uid,
  name: anon.value==="yes"?"Anonymous":auth.currentUser.displayName,
  likes:[],
  time:Date.now()
 });
 teaText.value="";
};

/* Feed */
function loadFeed(){
 db.collection("posts").orderBy("time","desc")
 .onSnapshot(snap=>{
  feed.innerHTML="";
  snap.forEach(doc=>{
   const p=doc.data();
   const liked=p.likes.includes(auth.currentUser?.uid);
   feed.innerHTML+=`
    <div class="card">
     <b>@${p.name}</b>
     <p>${p.text}</p>
     <small>${new Date(p.time).toLocaleString()}</small><br><br>
     <button onclick="likePost('${doc.id}')">${liked?"â¤ï¸":"ğŸ¤"}</button>
     ${p.uid===auth.currentUser?.uid?`<button onclick="deletePost('${doc.id}')">ğŸ—‘ï¸</button>`:""}
    </div>`;
  });
 });
}

/* Like */
function likePost(id){
 const ref=db.collection("posts").doc(id);
 ref.get().then(d=>{
  const likes=d.data().likes||[];
  const uid=auth.currentUser.uid;
  ref.update({
   likes: likes.includes(uid)?likes.filter(x=>x!==uid):[...likes,uid]
  });
 });
}

/* Delete */
function deletePost(id){
 db.collection("posts").doc(id).delete();
}

/* Browse users */
function loadUsers(){
 db.collection("users").onSnapshot(snap=>{
  usersList.innerHTML="";
  snap.forEach(d=>{
   usersList.innerHTML+=`
    <div class="card">@${d.data().name}</div>`;
  });
 });
}

/* Profile */
function loadProfile(u){
 profileCard.innerHTML=`
  <b>${u.displayName}</b><br>
  <small>${u.email}</small>
 `;
}
</script>

</body>
</html>
