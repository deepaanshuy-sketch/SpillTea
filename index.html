<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SpillTea â˜•</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{--bg:#121212;--card:#1e1e1e;--accent:#8b5e34;}
body{margin:0;background:var(--bg);color:#fff;font-family:system-ui}
header{padding:1rem;background:#1a1a1a;display:flex;justify-content:space-between;position:sticky;top:0}
button{background:var(--accent);border:none;color:#fff;padding:8px 14px;border-radius:8px}
.container{padding:1rem;padding-bottom:6rem}
.card{background:var(--card);padding:1rem;border-radius:12px;margin-bottom:1rem}
textarea,input{width:100%;border:none;border-radius:8px;padding:.6rem;margin:.4rem 0}
nav{position:fixed;bottom:0;width:100%;background:#1a1a1a;display:flex;justify-content:space-around;padding:.7rem}
.hidden{display:none}
small{color:#aaa}
.comment{margin-left:1rem;font-size:.9rem}
</style>
</head>

<body>

<header>
 <h3>SpillTea â˜•</h3>
 <button id="authBtn">Login</button>
</header>

<div class="container">

<div id="homePage">
 <div id="spillBox" class="card hidden">
  <textarea id="teaText" placeholder="Spill tea â˜• (no personal info)"></textarea>
  <select id="anon">
   <option value="no">Public</option>
   <option value="yes">Anonymous</option>
  </select>
  <button onclick="spillTea()">Spill</button>
 </div>
 <div id="feed"></div>
</div>

<div id="browsePage" class="hidden">
 <input id="search" placeholder="Search user..." oninput="searchUser()">
 <div id="results"></div>
</div>

<div id="profilePage" class="hidden">
 <h3 id="pName"></h3>
 <textarea id="bio" placeholder="Your bio"></textarea>
 <button onclick="saveBio()">Save Bio</button>
 <p>Posts: <b id="postCount">0</b></p>
 <p>Followers: <b id="followerCount">0</b></p>
 <p>Following: <b id="followingCount">0</b></p>
</div>

</div>

<nav>
 <span onclick="show('home')">ğŸ </span>
 <span onclick="show('browse')">ğŸ”</span>
 <span onclick="show('profile')">ğŸ‘¤</span>
</nav>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyBsCftGcy-dH8RxxP2UxKoGG4DapRHHASo",
 authDomain:"spilltea-54aa8.firebaseapp.com",
 projectId:"spilltea-54aa8"
});

const auth=firebase.auth();
const db=firebase.firestore();
const provider=new firebase.auth.GoogleAuthProvider();

function show(p){
 ["home","browse","profile"].forEach(x=>{
  document.getElementById(x+"Page").classList.add("hidden")
 });
 document.getElementById(p+"Page").classList.remove("hidden")
}

auth.onAuthStateChanged(u=>{
 if(u){
  authBtn.innerText="Logout";
  spillBox.classList.remove("hidden");
  db.collection("users").doc(u.uid).set({
   name:u.displayName,
   followers:[],
   following:[]
  },{merge:true});
  loadFeed();loadProfile();
 }else{
  authBtn.innerText="Login";
 }
});

authBtn.onclick=()=>{
 auth.currentUser?auth.signOut():auth.signInWithPopup(provider)
};

function spillTea(){
 if(!teaText.value)return;
 db.collection("posts").add({
  text:teaText.value,
  uid:auth.currentUser.uid,
  name:anon.value==="yes"?"Anonymous":auth.currentUser.displayName,
  likes:[],
  time:Date.now()
 });
 teaText.value="";
}

function loadFeed(){
 db.collection("posts").orderBy("time","desc")
 .onSnapshot(s=>{
  feed.innerHTML="";
  s.forEach(d=>{
   const p=d.data();
   feed.innerHTML+=`
   <div class="card">
    <b>@${p.name}</b>
    <p>${p.text}</p>
    <small>
     â¤ï¸ ${p.likes.length}
     <button onclick="like('${d.id}')">Like</button>
     <button onclick="report('${d.id}')">ğŸš©</button>
    </small>
   </div>`;
  });
 });
}

function like(id){
 const ref=db.collection("posts").doc(id);
 ref.update({
  likes:firebase.firestore.FieldValue.arrayUnion(auth.currentUser.uid)
 });
}

function report(id){
 db.collection("reports").add({post:id,time:Date.now()});
 alert("Reported");
}

function searchUser(){
 const q=search.value.toLowerCase();
 results.innerHTML="";
 db.collection("users").get().then(s=>{
  s.forEach(d=>{
   if(d.data().name.toLowerCase().includes(q)){
    results.innerHTML+=`
     <div class="card">
      <b>${d.data().name}</b>
      <button onclick="follow('${d.id}')">Follow</button>
     </div>`;
   }
  });
 });
}

function follow(uid){
 const me=auth.currentUser.uid;
 db.collection("users").doc(me)
 .update({following:firebase.firestore.FieldValue.arrayUnion(uid)});
 db.collection("users").doc(uid)
 .update({followers:firebase.firestore.FieldValue.arrayUnion(me)});
}

function loadProfile(){
 const u=auth.currentUser;
 pName.innerText=u.displayName;

 db.collection("users").doc(u.uid)
 .onSnapshot(d=>{
  bio.value=d.data().bio||"";
  followerCount.innerText=d.data().followers.length;
  followingCount.innerText=d.data().following.length;
 });

 db.collection("posts").where("uid","==",u.uid)
 .onSnapshot(s=>postCount.innerText=s.size);
}

function saveBio(){
 db.collection("users").doc(auth.currentUser.uid)
 .update({bio:bio.value});
 alert("Bio saved");
}
</script>

</body>
</html>
