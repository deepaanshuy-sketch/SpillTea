<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SpillTea â˜•</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
 --bg:#121212;
 --card:#1e1e1e;
 --accent:#8b5e34;
}
body{
 margin:0;
 background:var(--bg);
 color:#fff;
 font-family:system-ui;
}
header{
 padding:1rem;
 background:#1a1a1a;
 display:flex;
 justify-content:space-between;
 align-items:center;
 position:sticky;
 top:0;
 z-index:10;
}
button{
 background:var(--accent);
 border:none;
 color:#fff;
 padding:8px 14px;
 border-radius:8px;
 cursor:pointer;
}
.container{
 padding:1rem;
 padding-bottom:6rem;
}
.card{
 background:var(--card);
 padding:1rem;
 border-radius:12px;
 margin-bottom:1rem;
}
textarea,input{
 width:100%;
 border-radius:8px;
 border:none;
 padding:.6rem;
 margin-bottom:.5rem;
}
nav{
 position:fixed;
 bottom:0;
 width:100%;
 background:#1a1a1a;
 display:flex;
 justify-content:space-around;
 padding:.7rem 0;
}
nav span{cursor:pointer}
small{color:#aaa}
.hidden{display:none}
</style>
</head>

<body>

<header>
 <h3>SpillTea â˜•</h3>
 <button id="authBtn">Login</button>
</header>

<div class="container">

<!-- HOME -->
<div id="homePage">
 <div id="spillBox" class="card hidden">
  <textarea id="teaText" placeholder="Spill tea â˜• (no personal info)"></textarea>
  <select id="anon">
   <option value="no">Public</option>
   <option value="yes">Anonymous</option>
  </select>
  <button id="spillBtn">Spill</button>
 </div>
 <div id="feed"></div>
</div>

<!-- FOLLOWERS TEA -->
<div id="followersPage" class="hidden">
 <h3>Followersâ€™ Tea ğŸµ</h3>
 <p><small>Same feed for now</small></p>
</div>

<!-- BROWSE -->
<div id="browsePage" class="hidden">
 <input id="searchUser" placeholder="Search user...">
 <div id="searchResult"></div>
</div>

<!-- GCS -->
<div id="gcPage" class="hidden">
 <h3>Group Chats ğŸ’¬</h3>
 <p><small>Coming soon</small></p>
</div>

<!-- PROFILE -->
<div id="profilePage" class="hidden">
 <h3 id="pName"></h3>
 <textarea id="bio" placeholder="Your bio"></textarea>
 <button onclick="saveBio()">Save Bio</button>
 <p>Posts: <b id="postCount">0</b></p>
 <p>Followers: <b id="followerCount">0</b></p>
</div>

</div>

<nav>
 <span onclick="showPage('home')">ğŸ </span>
 <span onclick="showPage('followers')">ğŸµ</span>
 <span onclick="showPage('browse')">ğŸ”</span>
 <span onclick="showPage('gc')">ğŸ’¬</span>
 <span onclick="showPage('profile')">ğŸ‘¤</span>
</nav>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
 apiKey: "AIzaSyBsCftGcy-dH8RxxP2UxKoGG4DapRHHASo",
 authDomain: "spilltea-54aa8.firebaseapp.com",
 projectId: "spilltea-54aa8"
});

const auth = firebase.auth();
const db = firebase.firestore();
const provider = new firebase.auth.GoogleAuthProvider();

const authBtn = document.getElementById("authBtn");
const spillBox = document.getElementById("spillBox");
const feed = document.getElementById("feed");

function showPage(p){
 ["home","followers","browse","gc","profile"].forEach(x=>{
  document.getElementById(x+"Page").classList.add("hidden");
 });
 document.getElementById(p+"Page").classList.remove("hidden");
}

auth.onAuthStateChanged(user=>{
 if(user){
  authBtn.innerText="Logout";
  spillBox.classList.remove("hidden");
  loadFeed();
  loadProfile();
 }else{
  authBtn.innerText="Login";
  spillBox.classList.add("hidden");
 }
});

authBtn.onclick=()=>{
 auth.currentUser ? auth.signOut() : auth.signInWithPopup(provider);
};

document.getElementById("spillBtn").onclick=()=>{
 const text=document.getElementById("teaText").value.trim();
 if(!text) return;

 db.collection("posts").add({
  uid:auth.currentUser.uid,
  text,
  name:document.getElementById("anon").value==="yes"?"Anonymous":auth.currentUser.displayName,
  time:Date.now()
 });
 document.getElementById("teaText").value="";
};

function loadFeed(){
 db.collection("posts").orderBy("time","desc")
 .onSnapshot(s=>{
  feed.innerHTML="";
  s.forEach(d=>{
   const p=d.data();
   feed.innerHTML+=`
    <div class="card">
     <b>@${p.name}</b>
     <p>${p.text}</p>
     <small>${new Date(p.time).toLocaleString()}</small>
    </div>`;
  });
 });
}

function loadProfile(){
 const u=auth.currentUser;
 document.getElementById("pName").innerText=u.displayName;

 db.collection("users").doc(u.uid).get().then(d=>{
  if(d.exists) bio.value=d.data().bio||"";
 });

 db.collection("posts").where("uid","==",u.uid)
 .onSnapshot(s=>postCount.innerText=s.size);
}

function saveBio(){
 db.collection("users").doc(auth.currentUser.uid)
 .set({bio:bio.value},{merge:true});
 alert("Bio saved");
}
</script>

</body>
</html>
