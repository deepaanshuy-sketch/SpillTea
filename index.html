<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SpillTea â˜•</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
 --bg:#121212;
 --card:#1e1e1e;
 --accent:#8b5e34;
}
body{
 margin:0;background:var(--bg);color:#fff;
 font-family:system-ui;overflow-x:hidden
}
header{
 padding:1rem;background:#1a1a1a;
 display:flex;justify-content:space-between;
 position:sticky;top:0;z-index:10
}
button{
 background:var(--accent);border:none;color:#fff;
 padding:6px 10px;border-radius:6px;
 transition:.2s;cursor:pointer
}
button:hover{transform:scale(1.05)}
textarea,input,select{
 background:var(--card);color:#fff;
 border:1px solid #333;padding:6px
}
.container{padding:1rem;padding-bottom:7rem}
.card{
 background:var(--card);
 padding:1rem;border-radius:12px;
 margin-bottom:1rem;
 animation:fade .3s ease
}
@keyframes fade{from{opacity:0;transform:translateY(10px)}}
small{color:#aaa}
.tag{color:#4fc3f7;cursor:pointer}
nav{
 position:fixed;bottom:0;width:100%;
 background:#1a1a1a;
 display:flex;justify-content:space-around;
 padding:.8rem 0
}
.badge{color:#4caf50;font-size:.8rem}
</style>
</head>

<body>

<header>
<h3>SpillTea â˜•</h3>
<button id="authBtn">Login</button>
</header>

<div class="container">

<div id="spillBox" hidden>
<textarea id="teaText" placeholder="Spill tea â˜•"></textarea><br><br>
<input type="color" id="textColor">
<select id="anon">
<option value="no">Public</option>
<option value="yes">Anonymous</option>
</select>
<button onclick="spillTea()">Spill</button>
<hr>
</div>

<div id="trending"></div>
<div id="feed"></div>

</div>

<nav>
<span onclick="loadFeed()">ğŸ </span>
<span onclick="showInvite()">ğŸ”—</span>
<span onclick="showAdmin()">ğŸ›¡ï¸</span>
</nav>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDxxxxxx",
  authDomain: "spilltea-123.firebaseapp.com",
  projectId: "spilltea-123",
  storageBucket: "spilltea-123.appspot.com",
  messagingSenderId: "123456789",
  appId: "1:123:web:abc"
});

const ADMIN_UID="YOUR_UID_HERE";
const auth=firebase.auth();
const db=firebase.firestore();
let lastPostTime=0;

auth.onAuthStateChanged(u=>{
 if(u){
  authBtn.innerText="Logout";
  spillBox.hidden=false;
  db.collection("users").doc(u.uid).set({
   name:u.displayName,
   verified:false,
   coins:10
  },{merge:true});
  loadFeed();loadTrending();
 }else{
  authBtn.innerText="Login";
 }
});

authBtn.onclick=()=>{
 auth.currentUser?auth.signOut():
 auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
};

function spillTea(){
 const now=Date.now();
 if(now-lastPostTime<60000){
  alert("Chill â˜• one tea per minute");return;
 }
 lastPostTime=now;

 const txt=teaText.value.trim();
 if(!txt) return;

 const tags=txt.match(/#\w+/g)||[];
 db.collection("posts").add({
  text:txt,tags,
  anon:anon.value==="yes",
  name:anon.value==="yes"?"Anonymous":auth.currentUser.displayName,
  uid:auth.currentUser.uid,
  color:textColor.value,
  time:now
 });

 tags.forEach(t=>{
  db.collection("trending").doc(t)
  .set({count:firebase.firestore.FieldValue.increment(1)},{merge:true});
 });
 teaText.value="";
}

function loadFeed(tag=null){
 feed.innerHTML="";
 db.collection("posts").orderBy("time","desc")
 .onSnapshot(s=>{
  feed.innerHTML="";
  s.forEach(d=>{
   const p=d.data();
   if(tag && !p.tags.includes(tag)) return;
   feed.innerHTML+=`
   <div class="card">
    <b>@${p.name}</b>
    ${p.uid===ADMIN_UID?'<span class="badge">âœ”</span>':""}
    <p style="color:${p.color}">
    ${p.text.replace(/#\w+/g,m=>`<span class="tag" onclick="loadFeed('${m}')">${m}</span>`)}
    </p>
    <small>
     <span onclick="tip('${p.uid}')">ğŸ’° Tip</span> Â·
     <span onclick="report('${d.id}')">ğŸš©</span>
    </small>
   </div>`;
  });
 });
}

function tip(uid){
 if(uid===auth.currentUser.uid) return;
 db.collection("users").doc(auth.currentUser.uid)
 .update({coins:firebase.firestore.FieldValue.increment(-1)});
 db.collection("users").doc(uid)
 .update({coins:firebase.firestore.FieldValue.increment(1)});
 alert("Tipped â˜•");
}

function report(id){
 db.collection("reports").add({post:id,time:Date.now()});
 alert("Reported");
}

function loadTrending(){
 db.collection("trending").orderBy("count","desc").limit(5)
 .onSnapshot(s=>{
  trending.innerHTML="<b>Trending â˜•</b><br>";
  s.forEach(d=>{
   trending.innerHTML+=`<span class="tag" onclick="loadFeed('${d.id}')">${d.id}</span> `;
  });
 });
}

function showInvite(){
 const code=Math.random().toString(36).slice(2,8);
 db.collection("invites").doc(code)
 .set({by:auth.currentUser.uid});
 alert("Invite code: "+code);
}

function showAdmin(){
 if(auth.currentUser.uid!==ADMIN_UID) return alert("No access");
 alert("Admin panel coming (reports + verify users)");
}
</script>

</body>
</html>
