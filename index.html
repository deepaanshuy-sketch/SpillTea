<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SpillTea ‚òï</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
 --bg:#121212;
 --card:#1e1e1e;
 --accent:#8b5e34;
}
body{
 margin:0;
 background:var(--bg);
 color:#fff;
 font-family:system-ui;
}
header{
 padding:1rem;
 background:#1a1a1a;
 display:flex;
 justify-content:space-between;
 align-items:center;
 position:sticky;
 top:0;
}
button{
 background:var(--accent);
 border:none;
 color:#fff;
 padding:8px 14px;
 border-radius:8px;
 cursor:pointer;
}
.container{
 padding:1rem;
 padding-bottom:6rem;
}
.card{
 background:var(--card);
 padding:1rem;
 border-radius:12px;
 margin-bottom:1rem;
}
textarea{
 width:100%;
 height:80px;
 border-radius:8px;
 border:none;
 padding:.5rem;
}
select{
 padding:6px;
 border-radius:6px;
}
nav{
 position:fixed;
 bottom:0;
 width:100%;
 background:#1a1a1a;
 display:flex;
 justify-content:center;
 padding:.8rem 0;
}
small{color:#aaa}
</style>
</head>

<body>

<header>
 <h3>SpillTea ‚òï</h3>
 <button id="authBtn">Login</button>
</header>

<div class="container">

<div id="spillBox" style="display:none">
 <textarea id="teaText" placeholder="Spill tea ‚òï"></textarea><br><br>

 <select id="anon">
  <option value="no">Public</option>
  <option value="yes">Anonymous</option>
 </select><br><br>

 <button id="spillBtn">Spill ‚òï</button>
 <hr>
</div>

<div id="feed"></div>

</div>

<nav>
 <span onclick="loadFeed()">üè† Home</span>
</nav>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* üî• Firebase init */
firebase.initializeApp({
 apiKey: "AIzaSyBsCftGcy-dH8RxxP2UxKoGG4DapRHHASo",
 authDomain: "spilltea-54aa8.firebaseapp.com",
 projectId: "spilltea-54aa8"
});

const auth = firebase.auth();
const db = firebase.firestore();
const provider = new firebase.auth.GoogleAuthProvider();

/* üîó DOM */
const authBtn = document.getElementById("authBtn");
const spillBox = document.getElementById("spillBox");
const feed = document.getElementById("feed");
const spillBtn = document.getElementById("spillBtn");
const teaText = document.getElementById("teaText");
const anon = document.getElementById("anon");

/* üîê Auth state */
auth.onAuthStateChanged(user=>{
 if(user){
  authBtn.innerText = "Logout";
  spillBox.style.display = "block";
  loadFeed();
 }else{
  authBtn.innerText = "Login";
  spillBox.style.display = "none";
 }
});

/* üîê Login / Logout */
authBtn.onclick = async ()=>{
 if(auth.currentUser){
  await auth.signOut();
 }else{
  await auth.signInWithPopup(provider);
 }
};

/* ‚òï Spill post */
spillBtn.onclick = async ()=>{
 if(!auth.currentUser){
  alert("Login first");
  return;
 }

 const text = teaText.value.trim();
 if(!text) return;

 await db.collection("posts").add({
  text,
  anon: anon.value==="yes",
  name: anon.value==="yes"
    ? "Anonymous"
    : auth.currentUser.displayName,
  time: Date.now()
 });

 teaText.value="";
};

/* üì∞ Feed */
function loadFeed(){
 db.collection("posts")
 .orderBy("time","desc")
 .onSnapshot(snap=>{
  feed.innerHTML="";
  snap.forEach(doc=>{
   const p = doc.data();
   feed.innerHTML += `
    <div class="card">
     <b>@${p.name}</b>
     <p>${p.text}</p>
     <small>${new Date(p.time).toLocaleString()}</small>
    </div>
   `;
  });
 });
}

loadFeed();
</script>

</body>
</html>
